/* Minimal date-fns compatibility shim
 * Purpose: provide the small set of date-fns functions used by chartjs-adapter-date-fns
 * Not a full reimplementation; intended for offline/local use where full date-fns UMD is unavailable.
 * Licensed: MIT-style (you may replace with the real date-fns UMD build when desired)
 */
(function (global, factory) {
  // UMD wrapper: expose as global `dateFns`
  if (typeof module === 'object' && typeof module.exports === 'object') {
    module.exports = factory();
  } else {
    global.dateFns = factory();
  }
}(typeof window !== 'undefined' ? window : this, function () {
  'use strict';

  function toDate(d) {
    if (d instanceof Date) return new Date(d.getTime());
    if (typeof d === 'number') return new Date(d);
    var parsed = new Date(d);
    return isNaN(parsed.getTime()) ? null : parsed;
  }

  function isValid(d) {
    return d instanceof Date && !isNaN(d.getTime());
  }

  function parseISO(str) {
    var d = new Date(str);
    return isNaN(d.getTime()) ? null : d;
  }

  function parse(_str, _format, _baseDate) {
    // Best-effort: if iso-like or common formats, rely on Date parsing.
    return parseISO(_str);
  }

  function format(date, token) {
    // Simple formatter to cover patterns used by adapter (approximate)
    if (!isValid(date)) return '';
    var dt = new Date(date.getTime());

    var parts = {
      yyyy: dt.getFullYear(),
      MM: String(dt.getMonth() + 1).padStart(2, '0'),
      M: String(dt.getMonth() + 1),
      dd: String(dt.getDate()).padStart(2, '0'),
      d: String(dt.getDate()),
      HH: String(dt.getHours()).padStart(2, '0'),
      H: String(dt.getHours()),
      hh: String(((dt.getHours() + 11) % 12) + 1).padStart(2, '0'),
      h: String(((dt.getHours() + 11) % 12) + 1),
      mm: String(dt.getMinutes()).padStart(2, '0'),
      ss: String(dt.getSeconds()).padStart(2, '0'),
      SSS: String(dt.getMilliseconds()).padStart(3, '0')
    };

    function monthShort(m) {
      return ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'][m];
    }

    // Handle some composed tokens used by the adapter
    return token
      .replace('yyyy', parts.yyyy)
      .replace('MMM', monthShort(dt.getMonth()))
      .replace('MM', parts.MM)
      .replace('M', parts.M)
      .replace('d', parts.d)
      .replace('dd', parts.dd)
      .replace('h', parts.h)
      .replace('hh', parts.hh)
      .replace('H', parts.H)
      .replace('HH', parts.HH)
      .replace('mm', parts.mm)
      .replace('ss', parts.ss)
      .replace('SSS', parts.SSS)
      .replace('aaaa', dt.getHours() < 12 ? 'AM' : 'PM');
  }

  /* addX helpers */
  function addMilliseconds(date, amount) { var d = new Date(date.getTime()); d.setMilliseconds(d.getMilliseconds() + amount); return d; }
  function addSeconds(date, amount) { return addMilliseconds(date, amount * 1000); }
  function addMinutes(date, amount) { return addMilliseconds(date, amount * 60 * 1000); }
  function addHours(date, amount) { return addMilliseconds(date, amount * 3600 * 1000); }
  function addDays(date, amount) { var d = new Date(date.getTime()); d.setDate(d.getDate() + amount); return d; }
  function addWeeks(date, amount) { return addDays(date, amount * 7); }
  function addMonths(date, amount) { var d = new Date(date.getTime()); var m = d.getMonth(); d.setMonth(m + amount); return d; }
  function addQuarters(date, amount) { return addMonths(date, amount * 3); }
  function addYears(date, amount) { var d = new Date(date.getTime()); d.setFullYear(d.getFullYear() + amount); return d; }

  /* difference helpers (simple ms-based approximations for months/years may be approximate) */
  function differenceInMilliseconds(a, b) { return Math.floor(a.getTime() - b.getTime()); }
  function differenceInSeconds(a, b) { return Math.floor(differenceInMilliseconds(a,b) / 1000); }
  function differenceInMinutes(a, b) { return Math.floor(differenceInMilliseconds(a,b) / (1000*60)); }
  function differenceInHours(a, b) { return Math.floor(differenceInMilliseconds(a,b) / (1000*3600)); }
  function differenceInDays(a, b) { return Math.floor(differenceInMilliseconds(a,b) / (1000*3600*24)); }
  function differenceInWeeks(a, b) { return Math.floor(differenceInDays(a,b) / 7); }
  function differenceInMonths(a, b) { return (a.getFullYear() - b.getFullYear())*12 + (a.getMonth() - b.getMonth()); }
  function differenceInQuarters(a, b) { return Math.floor(differenceInMonths(a,b) / 3); }
  function differenceInYears(a, b) { return a.getFullYear() - b.getFullYear(); }

  /* startOf / endOf helpers */
  function startOfSecond(date) { var d=new Date(date.getTime()); d.setMilliseconds(0); return d; }
  function startOfMinute(date) { var d=new Date(date.getTime()); d.setSeconds(0,0); return d; }
  function startOfHour(date) { var d=new Date(date.getTime()); d.setMinutes(0,0,0); return d; }
  function startOfDay(date) { var d=new Date(date.getTime()); d.setHours(0,0,0,0); return d; }
  function startOfWeek(date, opts) { var d=new Date(date.getTime()); var w = opts && opts.weekStartsOn ? opts.weekStartsOn : 0; var day = d.getDay(); var diff = (day < w) ? (7 - (w - day)) : (day - w); d.setDate(d.getDate() - diff); return startOfDay(d); }
  function startOfMonth(date) { var d=new Date(date.getTime()); d.setDate(1); return startOfDay(d); }
  function startOfQuarter(date) { var d=new Date(date.getTime()); var month = d.getMonth(); var qStart = Math.floor(month / 3) * 3; d.setMonth(qStart,1); return startOfDay(d); }
  function startOfYear(date) { var d=new Date(date.getTime()); d.setMonth(0,1); return startOfDay(d); }

  function endOfSecond(date) { var d = startOfSecond(date); d.setMilliseconds(999); return d; }
  function endOfMinute(date) { var d = startOfMinute(date); d.setSeconds(59,999); return d; }
  function endOfHour(date) { var d = startOfHour(date); d.setMinutes(59,59,999); return d; }
  function endOfDay(date) { var d = startOfDay(date); d.setHours(23,59,59,999); return d; }
  function endOfWeek(date, opts) { var s = startOfWeek(date, opts); return addDays(s, 6); }
  function endOfMonth(date) { var d = new Date(date.getFullYear(), date.getMonth()+1, 0); return endOfDay(d); }
  function endOfQuarter(date) { var s = startOfQuarter(date); return endOfMonth(addMonths(s, 2)); }
  function endOfYear(date) { var d = new Date(date.getFullYear(), 11, 31); return endOfDay(d); }

  return {
    toDate: toDate,
    parse: parse,
    parseISO: parseISO,
    isValid: isValid,
    format: format,
    addMilliseconds: addMilliseconds,
    addSeconds: addSeconds,
    addMinutes: addMinutes,
    addHours: addHours,
    addDays: addDays,
    addWeeks: addWeeks,
    addMonths: addMonths,
    addQuarters: addQuarters,
    addYears: addYears,
    differenceInMilliseconds: differenceInMilliseconds,
    differenceInSeconds: differenceInSeconds,
    differenceInMinutes: differenceInMinutes,
    differenceInHours: differenceInHours,
    differenceInDays: differenceInDays,
    differenceInWeeks: differenceInWeeks,
    differenceInMonths: differenceInMonths,
    differenceInQuarters: differenceInQuarters,
    differenceInYears: differenceInYears,
    startOfSecond: startOfSecond,
    startOfMinute: startOfMinute,
    startOfHour: startOfHour,
    startOfDay: startOfDay,
    startOfWeek: startOfWeek,
    startOfMonth: startOfMonth,
    startOfQuarter: startOfQuarter,
    startOfYear: startOfYear,
    endOfSecond: endOfSecond,
    endOfMinute: endOfMinute,
    endOfHour: endOfHour,
    endOfDay: endOfDay,
    endOfWeek: endOfWeek,
    endOfMonth: endOfMonth,
    endOfQuarter: endOfQuarter,
    endOfYear: endOfYear
  };
}));